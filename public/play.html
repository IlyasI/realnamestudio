<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>brooklyn rpg - realname studio</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Space Grotesk', monospace;
      background: #1A1A1A;
      color: #F5F1E8;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .game-container {
      max-width: 900px;
      width: 100%;
      background: #2D1B3D;
      border: 6px solid #000;
      box-shadow: 12px 12px 0 rgba(0, 0, 0, 0.5);
    }

    .game-header {
      background: linear-gradient(135deg, #6B4C9A, #8B5DAF);
      border-bottom: 6px solid #000;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .game-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 32px;
      letter-spacing: 3px;
      color: #FFD700;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
    }

    .stats-row {
      display: flex;
      gap: 20px;
      font-size: 14px;
      font-weight: 700;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .tabs {
      display: flex;
      background: rgba(0, 0, 0, 0.4);
      border-bottom: 4px solid #000;
    }

    .tab {
      flex: 1;
      padding: 15px 10px;
      text-align: center;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 18px;
      letter-spacing: 2px;
      cursor: pointer;
      background: transparent;
      border: none;
      color: rgba(255, 215, 0, 0.6);
      transition: all 0.2s ease;
      border-right: 2px solid rgba(0, 0, 0, 0.5);
    }

    .tab:last-child {
      border-right: none;
    }

    .tab.active {
      background: #FFD700;
      color: #1A1A1A;
    }

    .tab:hover:not(.active) {
      background: rgba(255, 215, 0, 0.1);
      color: #FFD700;
    }

    .game-body {
      padding: 25px;
      max-height: 600px;
      overflow-y: auto;
      background: rgba(107, 76, 154, 0.2);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .section {
      background: rgba(0, 0, 0, 0.3);
      border: 4px solid rgba(255, 215, 0, 0.3);
      padding: 20px;
      margin-bottom: 20px;
    }

    .section-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 24px;
      letter-spacing: 2px;
      margin-bottom: 15px;
      color: #FFD700;
    }

    .bar {
      height: 22px;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 215, 0, 0.4);
      position: relative;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .bar-fill {
      height: 100%;
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 11px;
      color: #F5F1E8;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }

    .bar-fill.health {
      background: linear-gradient(90deg, #DC143C, #FF6347);
    }

    .bar-fill.energy {
      background: linear-gradient(90deg, #00CED1, #00D9FF);
    }

    .bar-fill.xp {
      background: linear-gradient(90deg, #DAA520, #FFD700);
    }

    .skill-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .skill-item {
      background: rgba(0, 0, 0, 0.4);
      padding: 12px;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .skill-name {
      font-weight: 700;
      font-size: 13px;
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
      color: #FFD700;
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .btn {
      font-family: 'Space Grotesk', monospace;
      font-size: 14px;
      font-weight: 600;
      padding: 12px;
      background: linear-gradient(135deg, #8B4513, #A0522D);
      border: 3px solid #000;
      color: #F5F1E8;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.5);
    }

    .btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #1A1A1A;
      transform: translateY(-2px);
      box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.5);
    }

    .btn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5);
    }

    .btn:disabled {
      background: #555;
      color: #888;
      cursor: not-allowed;
      opacity: 0.5;
    }

    .btn-combat {
      background: linear-gradient(135deg, #DC143C, #8B0000);
    }

    .btn-combat:hover:not(:disabled) {
      background: linear-gradient(135deg, #FF6347, #DC143C);
    }

    .item-list {
      display: grid;
      gap: 10px;
    }

    .item {
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(255, 215, 0, 0.3);
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .item-info {
      flex: 1;
    }

    .item-name {
      font-weight: 700;
      color: #FFD700;
      font-size: 14px;
    }

    .item-desc {
      font-size: 11px;
      color: rgba(245, 241, 232, 0.7);
      margin-top: 3px;
    }

    .item-price {
      font-weight: 700;
      color: #FFD700;
      margin-right: 10px;
    }

    .enemy-battle {
      background: rgba(220, 20, 60, 0.2);
      border: 3px solid #DC143C;
      padding: 20px;
      text-align: center;
      margin-bottom: 15px;
    }

    .enemy-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 28px;
      color: #DC143C;
      margin-bottom: 10px;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
    }

    .enemy-sprite {
      font-size: 64px;
      margin: 15px 0;
      filter: drop-shadow(0 0 10px rgba(220, 20, 60, 0.5));
    }

    .combat-log {
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 215, 0, 0.3);
      padding: 12px;
      max-height: 150px;
      overflow-y: auto;
      font-size: 11px;
      line-height: 1.6;
      margin-top: 15px;
      color: rgba(245, 241, 232, 0.9);
    }

    .map-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin: 20px 0;
    }

    .map-cell {
      aspect-ratio: 1;
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(255, 215, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .map-cell:hover {
      background: rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
    }

    .map-cell.current {
      background: rgba(255, 215, 0, 0.3);
      border-color: #FFD700;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #8B4513, #A0522D);
      color: #F5F1E8;
      padding: 12px 25px;
      border: 4px solid #000;
      box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.5);
      font-weight: 600;
      font-size: 13px;
      z-index: 1000;
      animation: slideDown 0.3s ease;
      max-width: 80%;
    }

    @keyframes slideDown {
      from {
        transform: translateX(-50%) translateY(-100px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    .footer-links {
      text-align: center;
      padding: 15px;
      border-top: 4px solid rgba(255, 215, 0, 0.3);
      background: rgba(0, 0, 0, 0.3);
    }

    .footer-links a {
      color: #FFD700;
      text-decoration: none;
      font-weight: 600;
      font-size: 13px;
      margin: 0 10px;
    }

    .footer-links a:hover {
      color: #FFA500;
    }

    .quest-item {
      background: rgba(0, 0, 0, 0.4);
      border: 3px solid rgba(255, 215, 0, 0.5);
      padding: 15px;
      margin-bottom: 12px;
    }

    .quest-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 18px;
      color: #FFD700;
      margin-bottom: 8px;
    }

    .quest-completed {
      opacity: 0.5;
      border-color: rgba(0, 217, 255, 0.3);
    }

    .owned-tag, .equipped-tag {
      display: inline-block;
      padding: 2px 6px;
      font-size: 10px;
      font-weight: 700;
      border-radius: 2px;
      margin-left: 8px;
      background: #FFD700;
      color: #1A1A1A;
    }

    @media (max-width: 768px) {
      .game-title {
        font-size: 24px;
      }

      .stats-row {
        font-size: 12px;
        gap: 12px;
      }

      .button-grid {
        grid-template-columns: 1fr;
      }

      .skill-grid {
        grid-template-columns: 1fr;
      }

      .map-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="game-header">
      <div class="game-title">‚öîÔ∏è BROOKLYN QUEST</div>
      <div class="stats-row">
        <div class="stat-item">
          <span>üí∞</span>
          <span id="gold">0</span>
        </div>
        <div class="stat-item">
          <span>üìç</span>
          <span id="location">bridge gate</span>
        </div>
        <div class="stat-item">
          <span>‚öîÔ∏è</span>
          <span>Lv.<span id="combatLevel">1</span></span>
        </div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="game.switchTab('explore')">Explore</button>
      <button class="tab" onclick="game.switchTab('character')">Character</button>
      <button class="tab" onclick="game.switchTab('combat')">Combat</button>
      <button class="tab" onclick="game.switchTab('quests')">Quests</button>
      <button class="tab" onclick="game.switchTab('shop')">Shop</button>
    </div>

    <div class="game-body">
      <!-- Explore Tab -->
      <div id="tab-explore" class="tab-content active">
        <div class="section">
          <div class="section-title">BROOKLYN MAP</div>
          <div id="mapContainer"></div>
          <div style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.3); border: 2px solid rgba(255,215,0,0.3);">
            <div style="font-weight: 700; margin-bottom: 8px;" id="locationName">Bridge Gate</div>
            <div style="font-size: 12px; line-height: 1.5; margin-bottom: 12px;" id="locationDesc">The entrance to Brooklyn Bridge. Goblins lurk beneath the arches.</div>
            <button class="btn" style="width: 100%;" onclick="game.explore()">üîç Explore Area</button>
          </div>
        </div>
      </div>

      <!-- Character Tab -->
      <div id="tab-character" class="tab-content">
        <div class="section">
          <div class="section-title">STATS</div>
          <div style="margin-bottom: 5px; font-size: 12px; font-weight: 600;">Health</div>
          <div class="bar">
            <div class="bar-fill health" id="healthBar">
              <span id="healthText">10/10</span>
            </div>
          </div>
          <div style="margin-bottom: 5px; font-size: 12px; font-weight: 600;">Energy</div>
          <div class="bar">
            <div class="bar-fill energy" id="energyBar">
              <span id="energyText">100/100</span>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">SKILLS</div>
          <div class="skill-grid" id="skillsContainer"></div>
        </div>

        <div class="section">
          <div class="section-title">EQUIPMENT</div>
          <div id="equipmentContainer"></div>
        </div>

        <div class="section">
          <div class="section-title">TRAIN</div>
          <div class="button-grid">
            <button class="btn" onclick="game.train('strength')">üí™ Train Strength</button>
            <button class="btn" onclick="game.train('defense')">üõ°Ô∏è Train Defense</button>
            <button class="btn" onclick="game.train('magic')">‚ú® Study Magic</button>
            <button class="btn" onclick="game.rest()">üí§ Rest</button>
          </div>
        </div>
      </div>

      <!-- Combat Tab -->
      <div id="tab-combat" class="tab-content">
        <div id="combatContainer"></div>
      </div>

      <!-- Quests Tab -->
      <div id="tab-quests" class="tab-content">
        <div class="section">
          <div class="section-title">ACTIVE QUESTS</div>
          <div id="questsContainer"></div>
        </div>
      </div>

      <!-- Shop Tab -->
      <div id="tab-shop" class="tab-content">
        <div class="section">
          <div class="section-title">BLACKSMITH</div>
          <div class="item-list" id="shopContainer"></div>
        </div>
      </div>
    </div>

    <div class="footer-links">
      <a href="/">‚Üê back to studio</a>
      <a href="#" onclick="game.resetGame(); return false;">reset</a>
    </div>
  </div>

  <script>
    const game = {
      player: {
        gold: 0,
        health: 10,
        maxHealth: 10,
        energy: 100,
        maxEnergy: 100,
        position: { x: 2, y: 2 }, // center of map
        skills: {
          strength: { xp: 0, level: 1 },
          defense: { xp: 0, level: 1 },
          magic: { xp: 0, level: 1 }
        },
        equipment: {
          weapon: null,
          armor: null,
          shield: null
        },
        inventory: [],
        completedQuests: [],
        defeatedEnemies: {},
        inCombat: false,
        currentEnemy: null
      },

      currentTab: 'explore',

      // 5x5 map grid
      map: [
        ['üè∞', 'üå≤', 'üå≤', 'üèîÔ∏è', 'üèîÔ∏è'],
        ['üå≤', '‚õ™', 'üèòÔ∏è', 'üå≤', 'üèîÔ∏è'],
        ['üåâ', 'üèòÔ∏è', 'üèõÔ∏è', 'üèòÔ∏è', 'üå≤'],
        ['üåä', 'üèòÔ∏è', 'üå≥', 'üèòÔ∏è', 'üóº'],
        ['üåä', 'üåä', 'üå≤', 'üå≤', 'üè≠']
      ],

      locations: {
        '0-0': { name: 'Castle Ruins', desc: 'Ancient ruins guard the northern edge. Dangerous creatures dwell within.', enemies: ['skeleton', 'dark_knight'] },
        '0-1': { name: 'Dark Forest', desc: 'Dense woods where wolves hunt.', enemies: ['wolf', 'bandit'] },
        '0-2': { name: 'Pine Grove', desc: 'Peaceful forest with minor threats.', enemies: ['rat', 'goblin'] },
        '0-3': { name: 'Mountain Pass', desc: 'Rocky terrain. Dragons have been spotted.', enemies: ['goblin', 'troll'] },
        '0-4': { name: 'Dragon Peak', desc: 'The highest peak. A dragon makes its lair here.', enemies: ['dragon'] },
        '1-0': { name: 'Haunted Woods', desc: 'Strange noises echo through the trees.', enemies: ['ghost', 'skeleton'] },
        '1-1': { name: 'Old Church', desc: 'Abandoned chapel. Undead roam the halls.', enemies: ['zombie', 'skeleton'] },
        '1-2': { name: 'Village Square', desc: 'A small settlement. Relatively safe.', enemies: ['rat', 'thief'] },
        '1-3': { name: 'Wildwood', desc: 'Untamed forest with wild beasts.', enemies: ['wolf', 'bear'] },
        '1-4': { name: 'Mountain Base', desc: 'Foothills of the great mountain.', enemies: ['goblin', 'troll'] },
        '2-0': { name: 'Bridge Gate', desc: 'The entrance to Brooklyn Bridge. Goblins lurk beneath the arches.', enemies: ['goblin', 'rat'] },
        '2-1': { name: 'Market District', desc: 'Bustling market. Watch for thieves.', enemies: ['thief', 'bandit'] },
        '2-2': { name: 'Town Center', desc: 'The heart of Brooklyn. Safe zone with shops and quests.', enemies: [] },
        '2-3': { name: 'Eastern District', desc: 'Residential area with some danger.', enemies: ['thief', 'rat'] },
        '2-4': { name: 'Tower District', desc: 'Ancient tower rises here.', enemies: ['wizard', 'gargoyle'] },
        '3-0': { name: 'Harbor', desc: 'Ships dock at the waterfront. Pirates prowl.', enemies: ['pirate', 'rat'] },
        '3-1': { name: 'Dockside', desc: 'Warehouses and shipyards.', enemies: ['pirate', 'thief'] },
        '3-2': { name: 'Park Entrance', desc: 'Gateway to the great park.', enemies: ['wolf', 'snake'] },
        '3-3': { name: 'Residential', desc: 'Quiet neighborhood.', enemies: ['rat', 'thief'] },
        '3-4': { name: 'Guard Tower', desc: 'Watchtower on the eastern edge.', enemies: ['bandit', 'mercenary'] },
        '4-0': { name: 'Deep Water', desc: 'Open sea. Sea monsters lurk below.', enemies: ['sea_serpent', 'kraken'] },
        '4-1': { name: 'Bay', desc: 'Shallow waters near shore.', enemies: ['pirate', 'sea_snake'] },
        '4-2': { name: 'Park West', desc: 'Western section of the great park.', enemies: ['wolf', 'bear'] },
        '4-3': { name: 'Park East', desc: 'Eastern section of the park.', enemies: ['wolf', 'snake'] },
        '4-4': { name: 'Industrial Zone', desc: 'Old factories and warehouses. Boss territory.', enemies: ['goblin_king', 'troll_chief'] }
      },

      enemies: {
        rat: { name: 'Giant Rat', sprite: 'üêÄ', health: 3, maxHealth: 3, attack: 1, defense: 0, xp: 5, gold: 3, messages: { appear: 'A giant rat squeaks aggressively!', attack: ['The rat bites!', 'Rat scratches with claws!'], defeat: 'The rat scurries away defeated.' } },
        goblin: { name: 'Goblin', sprite: 'üë∫', health: 8, maxHealth: 8, attack: 3, defense: 1, xp: 15, gold: 10, messages: { appear: 'A goblin appears with crude weapons!', attack: ['Goblin swings club!', 'Goblin throws rocks!'], defeat: 'The goblin flees in terror!' } },
        wolf: { name: 'Wolf', sprite: 'üê∫', health: 12, maxHealth: 12, attack: 5, defense: 2, xp: 20, gold: 15, messages: { appear: 'A hungry wolf emerges from the shadows!', attack: ['Wolf lunges with fangs!', 'Wolf claws viciously!'], defeat: 'The wolf retreats howling.' } },
        skeleton: { name: 'Skeleton Warrior', sprite: 'üíÄ', health: 15, maxHealth: 15, attack: 6, defense: 3, xp: 30, gold: 25, messages: { appear: 'Bones rattle as a skeleton rises!', attack: ['Skeleton swings rusty sword!', 'Bony fist strikes!'], defeat: 'The skeleton collapses into bones.' } },
        bandit: { name: 'Bandit', sprite: 'üó°Ô∏è', health: 18, maxHealth: 18, attack: 7, defense: 4, xp: 35, gold: 40, messages: { appear: 'A bandit demands your gold!', attack: ['Bandit slashes with dagger!', 'Bandit strikes quickly!'], defeat: 'The bandit drops his weapon and runs!' } },
        troll: { name: 'Troll', sprite: 'üëπ', health: 25, maxHealth: 25, attack: 10, defense: 6, xp: 50, gold: 60, messages: { appear: 'A massive troll blocks your path!', attack: ['Troll smashes with huge fists!', 'Troll charges forward!'], defeat: 'The troll stumbles away bleeding.' } },
        bear: { name: 'Brown Bear', sprite: 'üêª', health: 30, maxHealth: 30, attack: 12, defense: 7, xp: 60, gold: 50, messages: { appear: 'An angry bear roars!', attack: ['Bear swipes with powerful claws!', 'Bear mauls!'], defeat: 'The bear retreats into the forest.' } },
        dragon: { name: 'Ancient Dragon', sprite: 'üêâ', health: 100, maxHealth: 100, attack: 25, defense: 15, xp: 500, gold: 500, messages: { appear: 'A DRAGON descends from the sky!', attack: ['Dragon breathes fire!', 'Dragon strikes with massive claws!', 'Dragon tail whips!'], defeat: 'The dragon flies away, defeated!' } },
        goblin_king: { name: 'Goblin King', sprite: 'üëë', health: 60, maxHealth: 60, attack: 18, defense: 10, xp: 200, gold: 300, messages: { appear: 'The Goblin King appears with his crown!', attack: ['King swings enchanted mace!', 'King commands goblin magic!'], defeat: 'The Goblin King flees, dropping his crown!' } }
      },

      equipment: {
        wooden_sword: { id: 'wooden_sword', name: 'Wooden Sword', type: 'weapon', attack: 2, defense: 0, price: 50, desc: '+2 attack' },
        iron_sword: { id: 'iron_sword', name: 'Iron Sword', type: 'weapon', attack: 5, defense: 0, price: 200, desc: '+5 attack' },
        steel_sword: { id: 'steel_sword', name: 'Steel Sword', type: 'weapon', attack: 10, defense: 0, price: 500, desc: '+10 attack' },
        dragon_sword: { id: 'dragon_sword', name: 'Dragon Slayer', type: 'weapon', attack: 20, defense: 0, price: 2000, desc: '+20 attack' },

        wooden_shield: { id: 'wooden_shield', name: 'Wooden Shield', type: 'shield', attack: 0, defense: 2, price: 40, desc: '+2 defense' },
        iron_shield: { id: 'iron_shield', name: 'Iron Shield', type: 'shield', attack: 0, defense: 5, price: 180, desc: '+5 defense' },
        steel_shield: { id: 'steel_shield', name: 'Steel Shield', type: 'shield', attack: 0, defense: 10, price: 450, desc: '+10 defense' },

        leather_armor: { id: 'leather_armor', name: 'Leather Armor', type: 'armor', attack: 0, defense: 3, price: 100, desc: '+3 defense' },
        chainmail: { id: 'chainmail', name: 'Chainmail', type: 'armor', attack: 0, defense: 7, price: 300, desc: '+7 defense' },
        plate_armor: { id: 'plate_armor', name: 'Plate Armor', type: 'armor', attack: 0, defense: 15, price: 800, desc: '+15 defense' }
      },

      quests: [
        { id: 'first_blood', title: 'First Blood', desc: 'Defeat your first enemy.', requires: { enemiesDefeated: 1 }, reward: { gold: 50, xp: 25 }, progress: 0 },
        { id: 'goblin_slayer', title: 'Goblin Slayer', desc: 'Defeat 5 goblins.', requires: { enemyType: 'goblin', count: 5 }, reward: { gold: 150, xp: 75 }, progress: 0 },
        { id: 'first_weapon', title: 'Armed', desc: 'Purchase your first weapon.', requires: { equipmentType: 'weapon', count: 1 }, reward: { gold: 100, xp: 50 }, progress: 0 },
        { id: 'explorer', title: 'Explorer', desc: 'Visit 10 different locations.', requires: { locationsVisited: 10 }, reward: { gold: 200, xp: 100 }, progress: 0 },
        { id: 'dragon_slayer', title: 'Dragon Slayer', desc: 'Defeat the Ancient Dragon.', requires: { enemyType: 'dragon', count: 1 }, reward: { gold: 1000, xp: 500 }, progress: 0 }
      ],

      init() {
        this.loadGame();
        this.render();
        setInterval(() => this.saveGame(), 10000);
      },

      switchTab(tabName) {
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');
        this.currentTab = tabName;
        this.render();
      },

      getXPForLevel(level) {
        return Math.floor(100 * Math.pow(1.3, level - 1));
      },

      getCombatLevel() {
        return Math.floor((this.player.skills.strength.level + this.player.skills.defense.level) / 2);
      },

      getTotalAttack() {
        let attack = this.player.skills.strength.level;
        if (this.player.equipment.weapon) attack += this.equipment[this.player.equipment.weapon].attack;
        return attack;
      },

      getTotalDefense() {
        let defense = this.player.skills.defense.level;
        if (this.player.equipment.armor) defense += this.equipment[this.player.equipment.armor].defense;
        if (this.player.equipment.shield) defense += this.equipment[this.player.equipment.shield].defense;
        return defense;
      },

      train(skill) {
        if (this.player.energy < 10) {
          this.showMessage('Not enough energy. Rest to recover.');
          return;
        }

        this.player.energy -= 10;
        const skillData = this.player.skills[skill];
        const xpGain = 5;
        skillData.xp += xpGain;

        const xpNeeded = this.getXPForLevel(skillData.level);
        if (skillData.xp >= xpNeeded) {
          skillData.xp -= xpNeeded;
          skillData.level += 1;
          this.showMessage(`${skill} leveled up to ${skillData.level}!`);
        } else {
          this.showMessage(`Trained ${skill}. +${xpGain} xp`);
        }

        this.render();
        this.saveGame();
      },

      rest() {
        if (this.player.health === this.player.maxHealth && this.player.energy === this.player.maxEnergy) {
          this.showMessage('Already fully rested.');
          return;
        }

        this.player.health = this.player.maxHealth;
        this.player.energy = this.player.maxEnergy;
        this.showMessage('Rested. Health and energy restored.');
        this.render();
        this.saveGame();
      },

      moveTo(x, y) {
        if (x < 0 || x > 4 || y < 0 || y > 4) return;

        this.player.position = { x, y };
        const locKey = `${y}-${x}`;
        const location = this.locations[locKey];

        this.showMessage(`Arrived at ${location.name}`);
        this.trackQuestProgress('location');
        this.render();
        this.saveGame();
      },

      explore() {
        const locKey = `${this.player.position.y}-${this.player.position.x}`;
        const location = this.locations[locKey];

        if (!location.enemies || location.enemies.length === 0) {
          this.showMessage('This area is safe. No enemies found.');
          return;
        }

        // Random encounter
        if (Math.random() < 0.6) { // 60% chance
          const enemyKey = location.enemies[Math.floor(Math.random() * location.enemies.length)];
          this.startCombat(enemyKey);
        } else {
          this.showMessage('You searched but found nothing.');
        }
      },

      startCombat(enemyKey) {
        const enemyTemplate = this.enemies[enemyKey];
        this.player.currentEnemy = {
          key: enemyKey,
          ...enemyTemplate,
          health: enemyTemplate.maxHealth
        };
        this.player.inCombat = true;
        this.combatLog = [enemyTemplate.messages.appear];
        this.showMessage(enemyTemplate.messages.appear);
        this.switchTab('combat');
        this.render();
      },

      attack() {
        if (!this.player.inCombat || !this.player.currentEnemy) return;

        const enemy = this.player.currentEnemy;
        const playerDamage = Math.max(1, this.getTotalAttack() - Math.floor(enemy.defense / 2));
        enemy.health -= playerDamage;
        this.combatLog.push(`You deal ${playerDamage} damage!`);

        if (enemy.health <= 0) {
          this.combatLog.push(enemy.messages.defeat);
          this.showMessage(`Defeated ${enemy.name}! +${enemy.xp} xp +${enemy.gold} gold`);

          this.player.gold += enemy.gold;
          this.player.skills.strength.xp += Math.floor(enemy.xp / 2);
          this.player.skills.defense.xp += Math.floor(enemy.xp / 2);

          // Track defeated enemies
          this.player.defeatedEnemies[enemy.key] = (this.player.defeatedEnemies[enemy.key] || 0) + 1;
          this.trackQuestProgress('combat', enemy.key);

          // Check for level ups
          ['strength', 'defense'].forEach(skillKey => {
            const skill = this.player.skills[skillKey];
            const xpNeeded = this.getXPForLevel(skill.level);
            if (skill.xp >= xpNeeded) {
              skill.xp -= xpNeeded;
              skill.level += 1;
              this.showMessage(`${skillKey} leveled up to ${skill.level}!`);
            }
          });

          this.player.inCombat = false;
          this.player.currentEnemy = null;
          this.render();
          this.saveGame();
          return;
        }

        // Enemy attacks
        const enemyDamage = Math.max(1, enemy.attack - Math.floor(this.getTotalDefense() / 2));
        this.player.health -= enemyDamage;
        const attackMsg = enemy.messages.attack[Math.floor(Math.random() * enemy.messages.attack.length)];
        this.combatLog.push(`${attackMsg} -${enemyDamage} hp`);

        if (this.player.health <= 0) {
          this.player.health = this.player.maxHealth;
          this.player.inCombat = false;
          this.player.currentEnemy = null;
          this.combatLog.push('You were defeated... respawning at town center.');
          this.showMessage('Defeated! Respawned at town.');
          this.player.position = { x: 2, y: 2 };
        }

        this.render();
        this.saveGame();
      },

      flee() {
        if (!this.player.inCombat) return;
        this.player.inCombat = false;
        this.player.currentEnemy = null;
        this.showMessage('You fled to safety.');
        this.render();
      },

      buyEquipment(itemId) {
        const item = this.equipment[itemId];

        if (this.player.inventory.includes(itemId)) {
          this.showMessage('You already own this.');
          return;
        }

        if (this.player.gold < item.price) {
          this.showMessage('Not enough gold.');
          return;
        }

        this.player.gold -= item.price;
        this.player.inventory.push(itemId);
        this.showMessage(`Purchased ${item.name}!`);
        this.trackQuestProgress('equipment', item.type);
        this.render();
        this.saveGame();
      },

      equipItem(itemId) {
        const item = this.equipment[itemId];
        if (!this.player.inventory.includes(itemId)) return;

        this.player.equipment[item.type] = itemId;
        this.showMessage(`Equipped ${item.name}`);
        this.render();
        this.saveGame();
      },

      unequipItem(slot) {
        if (!this.player.equipment[slot]) return;
        this.player.equipment[slot] = null;
        this.showMessage(`Unequipped ${slot}`);
        this.render();
        this.saveGame();
      },

      trackQuestProgress(type, value) {
        this.quests.forEach(quest => {
          if (this.player.completedQuests.includes(quest.id)) return;

          if (type === 'combat') {
            if (quest.requires.enemiesDefeated) {
              const totalDefeated = Object.values(this.player.defeatedEnemies).reduce((a, b) => a + b, 0);
              if (totalDefeated >= quest.requires.enemiesDefeated) {
                this.completeQuest(quest.id);
              }
            }
            if (quest.requires.enemyType === value) {
              quest.progress = (this.player.defeatedEnemies[value] || 0);
              if (quest.progress >= quest.requires.count) {
                this.completeQuest(quest.id);
              }
            }
          }

          if (type === 'equipment' && quest.requires.equipmentType === value) {
            const count = this.player.inventory.filter(id => this.equipment[id].type === value).length;
            if (count >= quest.requires.count) {
              this.completeQuest(quest.id);
            }
          }

          if (type === 'location' && quest.requires.locationsVisited) {
            // Track unique locations visited (would need to add tracking)
          }
        });
      },

      completeQuest(questId) {
        const quest = this.quests.find(q => q.id === questId);
        if (!quest || this.player.completedQuests.includes(questId)) return;

        this.player.completedQuests.push(questId);
        this.player.gold += quest.reward.gold;
        this.player.skills.strength.xp += quest.reward.xp;

        this.showMessage(`Quest Complete: ${quest.title}! +${quest.reward.gold} gold +${quest.reward.xp} xp`);
        this.render();
        this.saveGame();
      },

      showMessage(text) {
        const existing = document.querySelector('.message');
        if (existing) existing.remove();

        const msg = document.createElement('div');
        msg.className = 'message';
        msg.textContent = text;
        document.body.appendChild(msg);

        setTimeout(() => msg.remove(), 3500);
      },

      render() {
        document.getElementById('gold').textContent = this.player.gold + 'g';
        const locKey = `${this.player.position.y}-${this.player.position.x}`;
        const currentLoc = this.locations[locKey];
        document.getElementById('location').textContent = currentLoc.name.toLowerCase();
        document.getElementById('combatLevel').textContent = this.getCombatLevel();

        if (this.currentTab === 'explore') this.renderExploreTab();
        else if (this.currentTab === 'character') this.renderCharacterTab();
        else if (this.currentTab === 'combat') this.renderCombatTab();
        else if (this.currentTab === 'quests') this.renderQuestsTab();
        else if (this.currentTab === 'shop') this.renderShopTab();
      },

      renderExploreTab() {
        const mapContainer = document.getElementById('mapContainer');
        mapContainer.innerHTML = '';
        mapContainer.className = 'map-grid';

        for (let y = 0; y < 5; y++) {
          for (let x = 0; x < 5; x++) {
            const cell = document.createElement('div');
            cell.className = 'map-cell';
            if (x === this.player.position.x && y === this.player.position.y) {
              cell.classList.add('current');
            }
            cell.textContent = this.map[y][x];
            cell.onclick = () => this.moveTo(x, y);
            mapContainer.appendChild(cell);
          }
        }

        const locKey = `${this.player.position.y}-${this.player.position.x}`;
        const location = this.locations[locKey];
        document.getElementById('locationName').textContent = location.name;
        document.getElementById('locationDesc').textContent = location.desc;
      },

      renderCharacterTab() {
        const healthPercent = (this.player.health / this.player.maxHealth) * 100;
        document.getElementById('healthBar').style.width = healthPercent + '%';
        document.getElementById('healthText').textContent = `${this.player.health}/${this.player.maxHealth}`;

        const energyPercent = (this.player.energy / this.player.maxEnergy) * 100;
        document.getElementById('energyBar').style.width = energyPercent + '%';
        document.getElementById('energyText').textContent = `${this.player.energy}/${this.player.maxEnergy}`;

        const skillsContainer = document.getElementById('skillsContainer');
        skillsContainer.innerHTML = '';

        Object.keys(this.player.skills).forEach(skillKey => {
          const skill = this.player.skills[skillKey];
          const xpNeeded = this.getXPForLevel(skill.level);
          const xpPercent = (skill.xp / xpNeeded) * 100;

          const skillDiv = document.createElement('div');
          skillDiv.className = 'skill-item';
          skillDiv.innerHTML = `
            <div class="skill-name">
              <span>${skillKey}</span>
              <span>Lv.${skill.level}</span>
            </div>
            <div class="bar">
              <div class="bar-fill xp" style="width: ${xpPercent}%">
                ${skill.xp}/${xpNeeded}
              </div>
            </div>
          `;
          skillsContainer.appendChild(skillDiv);
        });

        const equipmentContainer = document.getElementById('equipmentContainer');
        equipmentContainer.innerHTML = `
          <div style="margin-bottom: 10px; font-size: 13px;">
            <strong>Weapon:</strong> ${this.player.equipment.weapon ? this.equipment[this.player.equipment.weapon].name : 'None'}
            ${this.player.equipment.weapon ? `<button class="btn" style="padding: 4px 8px; font-size: 10px; margin-left: 8px;" onclick="game.unequipItem('weapon')">unequip</button>` : ''}
          </div>
          <div style="margin-bottom: 10px; font-size: 13px;">
            <strong>Armor:</strong> ${this.player.equipment.armor ? this.equipment[this.player.equipment.armor].name : 'None'}
            ${this.player.equipment.armor ? `<button class="btn" style="padding: 4px 8px; font-size: 10px; margin-left: 8px;" onclick="game.unequipItem('armor')">unequip</button>` : ''}
          </div>
          <div style="margin-bottom: 10px; font-size: 13px;">
            <strong>Shield:</strong> ${this.player.equipment.shield ? this.equipment[this.player.equipment.shield].name : 'None'}
            ${this.player.equipment.shield ? `<button class="btn" style="padding: 4px 8px; font-size: 10px; margin-left: 8px;" onclick="game.unequipItem('shield')">unequip</button>` : ''}
          </div>
          <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(255,215,0,0.3); font-size: 13px;">
            <div style="margin-bottom: 5px;"><strong>Total Attack:</strong> ${this.getTotalAttack()}</div>
            <div><strong>Total Defense:</strong> ${this.getTotalDefense()}</div>
          </div>
          ${this.player.inventory.length > 0 ? `
            <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(255,215,0,0.3);">
              <strong style="display: block; margin-bottom: 10px; font-size: 13px;">Inventory:</strong>
              ${this.player.inventory.map(itemId => {
                const item = this.equipment[itemId];
                const isEquipped = this.player.equipment[item.type] === itemId;
                return `
                  <div style="margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 12px;">
                    <span>${item.name} ${isEquipped ? '<span class="equipped-tag">EQUIPPED</span>' : ''}</span>
                    ${!isEquipped ? `<button class="btn" style="padding: 4px 8px; font-size: 10px;" onclick="game.equipItem('${itemId}')">equip</button>` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          ` : ''}
        `;
      },

      renderCombatTab() {
        const container = document.getElementById('combatContainer');

        if (this.player.inCombat && this.player.currentEnemy) {
          const enemy = this.player.currentEnemy;
          const enemyHealthPercent = (enemy.health / enemy.maxHealth) * 100;

          container.innerHTML = `
            <div class="enemy-battle">
              <div class="enemy-name">${enemy.name}</div>
              <div class="enemy-sprite">${enemy.sprite}</div>
              <div style="margin: 15px 0;">
                <div style="margin-bottom: 5px; font-size: 12px; font-weight: 600;">Enemy Health</div>
                <div class="bar">
                  <div class="bar-fill health" style="width: ${enemyHealthPercent}%">
                    ${enemy.health}/${enemy.maxHealth}
                  </div>
                </div>
              </div>
              <div class="button-grid">
                <button class="btn btn-combat" onclick="game.attack()">‚öîÔ∏è Attack</button>
                <button class="btn" onclick="game.flee()">üèÉ Flee</button>
              </div>
            </div>
            <div class="combat-log">
              ${this.combatLog.map(log => `<div>${log}</div>`).join('')}
            </div>
          `;
        } else {
          container.innerHTML = `
            <div class="section">
              <div class="section-title">NO ACTIVE COMBAT</div>
              <div style="text-align: center; padding: 40px 20px; font-size: 14px; line-height: 1.8;">
                <div style="font-size: 48px; margin-bottom: 15px;">‚öîÔ∏è</div>
                <div style="margin-bottom: 20px;">Go to the Explore tab and search areas to find enemies.</div>
                <div style="font-size: 12px; color: rgba(245,241,232,0.6);">Different locations have different creatures.</div>
              </div>
            </div>
          `;
        }
      },

      renderQuestsTab() {
        const container = document.getElementById('questsContainer');
        container.innerHTML = this.quests.map(quest => {
          const isCompleted = this.player.completedQuests.includes(quest.id);

          return `
            <div class="quest-item ${isCompleted ? 'quest-completed' : ''}">
              <div class="quest-title">${quest.title} ${isCompleted ? '‚úì' : ''}</div>
              <div style="font-size: 12px; line-height: 1.5; margin-bottom: 8px;">${quest.desc}</div>
              ${!isCompleted && quest.requires.count ? `<div style="font-size: 11px; margin: 5px 0; color: rgba(255,215,0,0.8);">Progress: ${quest.progress || 0}/${quest.requires.count}</div>` : ''}
              <div style="font-size: 11px; color: rgba(0,217,255,0.9); font-weight: 700;">Reward: ${quest.reward.gold}g + ${quest.reward.xp} XP</div>
            </div>
          `;
        }).join('');
      },

      renderShopTab() {
        const container = document.getElementById('shopContainer');
        container.innerHTML = Object.keys(this.equipment).map(itemId => {
          const item = this.equipment[itemId];
          const owned = this.player.inventory.includes(itemId);
          const isEquipped = this.player.equipment[item.type] === itemId;

          return `
            <div class="item">
              <div class="item-info">
                <div class="item-name">
                  ${item.name}
                  ${owned ? '<span class="owned-tag">OWNED</span>' : ''}
                  ${isEquipped ? '<span class="equipped-tag">EQUIPPED</span>' : ''}
                </div>
                <div class="item-desc">${item.desc}</div>
              </div>
              <span class="item-price">${item.price}g</span>
              <button class="btn" style="padding: 8px 15px; font-size: 12px;" ${owned ? 'disabled' : ''} onclick="game.buyEquipment('${itemId}')">
                ${owned ? 'owned' : 'buy'}
              </button>
            </div>
          `;
        }).join('');
      },

      saveGame() {
        localStorage.setItem('brooklynQuest', JSON.stringify(this.player));
      },

      loadGame() {
        const saved = localStorage.getItem('brooklynQuest');
        if (saved) {
          const loaded = JSON.parse(saved);
          this.player = { ...this.player, ...loaded };

          if (!this.player.defeatedEnemies) this.player.defeatedEnemies = {};
          if (!this.player.position) this.player.position = { x: 2, y: 2 };
        }
      },

      resetGame() {
        if (confirm('Reset all progress? This cannot be undone.')) {
          localStorage.removeItem('brooklynQuest');
          location.reload();
        }
      }
    };

    window.addEventListener('DOMContentLoaded', () => game.init());
  </script>
</body>
</html>
